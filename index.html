<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Adam Fix Store</title>
  <style>
    body {
      margin:0;
      font-family: Arial, sans-serif;
      background: linear-gradient(270deg,#ff7eb3,#ff758c,#42a5f5,#7e57c2);
      color: white; text-align:center; padding:20px;
    }
    h1 { text-shadow:0 0 12px rgba(0,0,0,0.5); }
    .items p { cursor:pointer; background:rgba(255,255,255,0.08); padding:12px; border-radius:8px; margin:8px auto; width:320px; color:yellow; }
    form { display:none; margin:20px auto; background:rgba(0,0,0,0.45); padding:16px; width:360px; border-radius:10px; text-align:left; }
    input, textarea, button { width:100%; padding:10px; margin:8px 0; border-radius:6px; border:none; font-size:14px; }
    button { background:#42a5f5; color:#fff; cursor:pointer; }
    button[disabled] { opacity:0.6; cursor:default; }
    #status { margin-top:10px; font-size:15px; color:#0f0; font-weight:bold; }
    #err { color:#ffb3b3; font-size:13px; margin-top:8px; white-space:pre-line; }
  </style>
</head>
<body>
  <h1>Adam Fix Store</h1>
  <p>Click an item to fill the form</p>

  <div class="items">
    <p onclick="prefill('Calculator','987 EGP')">üßÆ Calculator ‚Äî 987 EGP</p>
    <p onclick="prefill('Gun Toy','100 EGP')">üî´ Gun Toy ‚Äî 100 EGP</p>
    <p onclick="prefill('Toy Car','200 EGP')">üöó Toy Car ‚Äî 200 EGP</p>
    <p onclick="prefill('Tie','50 EGP')">üëî Tie ‚Äî 50 EGP</p>
  </div>

  <form id="orderForm">
    <h2>Buy Item</h2>
    <input type="hidden" name="item" id="item" />
    <input type="hidden" name="cash" id="cash" />
    <label>Your email</label>
    <input type="email" name="user_email" id="user_email" required />
    <label>Phone number</label>
    <input type="text" name="number" id="number" required />
    <label>Address</label>
    <input type="text" name="address" id="address" required />
    <label>Message / What happened</label>
    <textarea name="message" id="message"></textarea>
    <button id="submitBtn" type="submit">Buy</button>
    <div id="status"></div>
    <div id="err"></div>
  </form>

  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    const EMAILJS_SERVICE = "service_fdy3h4j";
    const EMAILJS_TEMPLATE = "template_s37d2qa";
    const EMAILJS_PUBLIC_KEY = "h0dABymW32jwHiXli";
    const FORMSPREE_ENDPOINT = "https://formspree.io/f/xjkenzwo";

    (function(){ emailjs.init(EMAILJS_PUBLIC_KEY); })();

    function prefill(itemName, cashVal) {
      document.getElementById("orderForm").style.display = "block";
      document.getElementById("item").value = itemName;
      document.getElementById("cash").value = cashVal;
      document.getElementById("status").innerText = "";
      document.getElementById("err").innerText = "";
      saveForm(); // keep saved
    }

    // Save form data to localStorage
    function saveForm() {
      const formData = {
        user_email: document.getElementById("user_email").value,
        number: document.getElementById("number").value,
        address: document.getElementById("address").value,
        message: document.getElementById("message").value,
        item: document.getElementById("item").value,
        cash: document.getElementById("cash").value
      };
      localStorage.setItem("adamfix_form", JSON.stringify(formData));
    }

    // Load saved data
    function loadForm() {
      const saved = localStorage.getItem("adamfix_form");
      if (saved) {
        const data = JSON.parse(saved);
        document.getElementById("user_email").value = data.user_email || "";
        document.getElementById("number").value = data.number || "";
        document.getElementById("address").value = data.address || "";
        document.getElementById("message").value = data.message || "";
        document.getElementById("item").value = data.item || "";
        document.getElementById("cash").value = data.cash || "";
        if (data.item) document.getElementById("orderForm").style.display = "block";
      }
    }

    loadForm();

    document.querySelectorAll("#orderForm input, #orderForm textarea").forEach(el => {
      el.addEventListener("input", saveForm);
    });

    document.getElementById("orderForm").addEventListener("submit", async function(ev){
      ev.preventDefault();
      const form = ev.target;
      const submitBtn = document.getElementById("submitBtn");
      const status = document.getElementById("status");
      const errDiv = document.getElementById("err");

      submitBtn.disabled = true;
      status.innerText = "‚è≥ Sending order‚Ä¶";
      errDiv.innerText = "";

      const formData = new FormData(form);

      function finishSuccess(msg){
        status.innerText = "‚úÖ Order placed! Please check your email for confirmation.";
        submitBtn.disabled = false;
        localStorage.removeItem("adamfix_form"); // clear saved after success
      }
      function finishError(msg){
        status.innerText = "";
        errDiv.innerText = msg;
        submitBtn.disabled = false;
      }

      try {
        await emailjs.sendForm(EMAILJS_SERVICE, EMAILJS_TEMPLATE, form);
        finishSuccess();
        return;
      } catch (emailErr) {
        finishError("‚ö†Ô∏è EmailJS failed. Trying Formspree fallback‚Ä¶");
      }

      try {
        const resp = await fetch(FORMSPREE_ENDPOINT, {
          method: 'POST',
          body: formData,
          headers: { 'Accept': 'application/json' }
        });
        if (resp.ok) {
          finishSuccess();
        } else {
          finishError("‚ùå Formspree failed.");
        }
      } catch (fetchErr) {
        finishError("‚ùå Both EmailJS and Formspree failed.");
      }
    });
  </script>
</body>
</html>
